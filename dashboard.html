<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AYUSH Connect EHR</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" />

  <!-- CSS -->
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Lexend', sans-serif; }
    body { background: #f5f7fa; color: #222; }

    .container { display: flex; height: 100vh; }

    /* Sidebar */
    .sidebar {
      width: 230px;
      background: #fff;
      border-right: 1px solid #eee;
      padding: 20px;
      display: flex;
      flex-direction: column;
    }
    .logo { font-size: 22px; font-weight: 700; color: #c62828; margin-bottom: 30px; }
    .logo span { color: #000; }
    .menu { list-style: none; padding: 0; }
    .menu li { margin: 12px 0; }
    .menu a { text-decoration: none; color: #333; font-weight: 500; display: flex; align-items: center; gap: 8px; padding: 8px 10px; border-radius: 8px; transition: all 0.3s; }
    .menu a:hover { background: #fdeaea; color: #c62828; cursor: pointer; }

    /* Main Content */
    .content { flex: 1; display: flex; flex-direction: column; }
    .topbar { display: flex; justify-content: space-between; align-items: center; background: #fff; padding: 10px 20px; border-bottom: 1px solid #eee; }
    .topbar input { width: 60%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 8px; }
    .topbar button { background:#c62828; color:white; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; }
    .user-section { display:flex; align-items:center; gap:15px; font-size:14px; color:#c62828; cursor:pointer; }
    .user-icon { font-size: 22px; }

    /* Main Section */
    .main-section { padding: 20px; overflow-y: auto; }

    .welcome-card { background: linear-gradient(90deg, #e53935, #f06292); color: white; padding: 25px; border-radius: 12px; margin-bottom: 25px; }
    .welcome-card h2 span { font-weight: 700; }

    /* Stats Section */
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px; }
    .stat-card { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 1px 6px rgba(0,0,0,0.05); display: flex; flex-direction: column; align-items: center; transition: transform 0.2s; }
    .stat-card:hover { transform: translateY(-5px); }
    .stat-card i { font-size: 30px; color: #c62828; margin-bottom: 10px; }
    .stat-card h3 { font-size: 22px; margin-bottom: 5px; }
    .stat-card p { color: #555; font-size: 14px; text-align: center; }

    /* Boxes Section */
    .boxes-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      grid-auto-rows: 180px;
      gap: 20px;
      margin-bottom: 25px;
    }
    .box-card {
      background:#fff;
      border-radius:12px;
      padding:20px;
      box-shadow:0 1px 6px rgba(0,0,0,0.05);
      text-align:center;
      transition: transform 0.2s, box-shadow 0.2s;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
    }
    .box-card:hover { transform: translateY(-5px); box-shadow: 0 6px 15px rgba(0,0,0,0.15); }
    .box-card h3 { color:#c62828; margin-bottom:15px; font-size:18px; }
    .box-card p { color:#555; font-size:14px; }

    /* Different sizes */
    .w-2 { grid-column: span 2; }
    .h-2 { grid-row: span 2; }

    /* Add Patient Form */
    #addPatientForm {
      display: none;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.1);
      margin-bottom: 25px;
    }
    #addPatientForm h2 { color: #c62828; margin-bottom: 15px; }
    #addPatientForm label { display: block; margin: 8px 0 4px; font-weight: 500; }
    #addPatientForm input, #addPatientForm select { width: 100%; padding: 8px 10px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 10px; }
    #addPatientForm button { background: #c62828; color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; }
    #addPatientForm button:hover { background: #e53935; }
    .success-msg { color: green; font-weight: 500; margin-top: 10px; }

    /* Diagnosis Table */
    #diagnosisSection {
      display:none;
      background:#fff;
      padding:20px;
      border-radius:12px;
      box-shadow:0 1px 6px rgba(0,0,0,0.1);
      margin-bottom:25px;
    }
    #diagnosisSection table { width:100%; border-collapse: collapse; margin-top:15px; }
    #diagnosisSection th, #diagnosisSection td { border:1px solid #ddd; padding:10px; text-align:center; }
    #diagnosisSection th { background:#fdeaea; color:#c62828; }
    .deleteBtn { color:#c62828; cursor:pointer; }
  </style>
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo">AYUSH <span>Connect</span></div>
      <ul class="menu">
        <li><a id="dashboardBtn"><i class="fas fa-home"></i>Dashboard</a></li>
        <li><a id="addPatientBtn"><i class="fas fa-user-plus"></i>Add Patient</a></li>
        <li><a href="/patient_records"><i class="fas fa-folder-open"></i>Patient Records</a></li>
        <li><a href="#"><i class="fas fa-user-md"></i>Doctors</a></li>
        <li><a href="/prescription"><i class="fas fa-pills"></i>Prescriptions</a></li>
        <li><a href="#"><i class="fas fa-brain"></i>NAMASTE Code</a></li>
        <li><a href="#"><i class="fas fa-globe"></i>ICD-11</a></li>
        <li><a href="/diagnosis"><i class="fas fa-stethoscope"></i> Diagnosis</a></li>
        <li><a id="diagnosisBtn"><i class="fas fa-file-medical"></i>Edit Info</a></li>
        <li><a href="#"><i class="fas fa-hospital"></i>Wards</a></li>
        <li><a href="#"><i class="fas fa-money-bill"></i>Billing</a></li>
        <li><a href="#"><i class="fas fa-chart-bar"></i>Reports</a></li>
      </ul>
    </aside>

    <!-- Main Content -->
    <main class="content">
      <header class="topbar">
        <div style="flex:1; display:flex; align-items:center; gap:10px;">
          <input type="text" placeholder="Search patients, doctors, records..." style="flex:1;">
          <button>Search</button>
        </div>
        <div class="user-section">
          <div class="user-icon"><i class="fas fa-user-circle"></i></div>
          <div>Sign Out <i class="fas fa-sign-out-alt"></i></div>
        </div>
      </header>

      <section class="main-section">
        <div class="welcome-card">
          <h2>Welcome to <span>AYUSH Connect EHR</span></h2>
          <p>Seamlessly integrate NAMASTE & ICD-11 codes in one place.</p>
        </div>

        <div id="addPatientForm">
          <h2>Add Patient - ID: <span id="patientId">...</span></h2>
          <form id="patientForm">
            <label>Name</label>
            <input type="text" name="name" required>
            <label>Age</label>
            <input type="number" name="age" required>
            <label>Gender</label>
            <select name="gender" required>
              <option value="">Select Gender</option>
              <option value="Male">Male</option>
              <option value="Female">Female</option>
              <option value="Other">Other</option>
            </select>
            <label>Address</label>
            <input type="text" name="address" required>
            <label>Contact Number</label>
            <input type="text" name="contact" required>
            <label>Date of Admission</label>
            <input type="date" name="admission_date" required>
            <label>Allocated Room</label>
            <input type="text" name="room" required>
            <button type="submit">Add Patient</button>
            <div class="success-msg" id="successMsg"></div>
          </form>
        </div>

        <!-- Diagnosis Section -->
        <div id="diagnosisSection">
          <h2>Patient Diagnosis</h2>
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Age</th>
                <th>Gender</th>
                <th>Contact</th>
                <th>Address</th>
                <th>Disease</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="diagnosisTableBody">
              <!-- JS will populate this -->
            </tbody>
          </table>
        </div>

        <div class="stats-grid">
          <div class="stat-card">
            <i class="fas fa-procedures"></i>
            <h3 id="totalPatients">125</h3>
            <p>Total Patients</p>
          </div>
          <div class="stat-card">
            <i class="fas fa-stethoscope"></i>
            <h3 id="doctorsAvailable">42</h3>
            <p>Doctors Available</p>
          </div>
          <div class="stat-card">
            <i class="fas fa-user-clock"></i>
            <h3 id="appointmentsToday">15</h3>
            <p>Appointments Today</p>
          </div>
          <div class="stat-card">
            <i class="fas fa-virus"></i>
            <h3 id="topDisease">Flu</h3>
            <p>Most Common Disease</p>
          </div>
        </div>

        <!-- Stylish Dashboard Boxes -->
        <div class="boxes-grid">
          <div class="box-card w-2 h-2">
            <h3>ðŸ“… Schedule Appointment</h3>
            <div id="calendar" style="margin-top:15px;"></div>
          </div>

          <div class="box-card w-2">
            <h3> Top Diseases</h3>
            <canvas id="diseaseChart" height="180"></canvas>
          </div>

          <div class="box-card">
            <h3> Patient Demographics</h3>
            <canvas id="demographicsChart" height="180"></canvas>
          </div>

          <div class="box-card h-2">
            <h3> Staff Attendance</h3>
            <canvas id="staffChart" height="180"></canvas>
          </div>

          <div class="box-card w-2">
            <h3>ðŸ“¦ Inventory Status</h3>
            <div style="margin-top:15px;">
              <div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>Medicines</span><span>75%</span></div>
              <div style="background:#eee; border-radius:8px; overflow:hidden; height:15px;"><div style="width:75%; background:#c62828; height:100%;"></div></div>

              <div style="display:flex; justify-content:space-between; margin:5px 0 5px;"><span>Equipment</span><span>50%</span></div>
              <div style="background:#eee; border-radius:8px; overflow:hidden; height:15px;"><div style="width:50%; background:#f06292; height:100%;"></div></div>

              <div style="display:flex; justify-content:space-between; margin-top:5px;"><span>Supplies</span><span>90%</span></div>
              <div style="background:#eee; border-radius:8px; overflow:hidden; height:15px;"><div style="width:90%; background:#c62828; height:100%;"></div></div>
            </div>
          </div>

          <div class="box-card">
            <h3>ðŸ’¬ Internal Messaging</h3>
            <div style="margin-top:10px; color:#555; font-size:14px;">3 New Messages</div>
            <div style="margin-top:5px; font-size:12px;">Click to open messaging system</div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const addPatientBtn = document.getElementById('addPatientBtn');
    const addPatientFormDiv = document.getElementById('addPatientForm');
    const patientIdSpan = document.getElementById('patientId');
    const patientForm = document.getElementById('patientForm');
    const successMsg = document.getElementById('successMsg');

    function fetchNextPatientId() {
      fetch('/next_patient_id')
        .then(res => res.json())
        .then(data => { patientIdSpan.textContent = data.next_id; });
    }

    addPatientBtn.addEventListener('click', () => {
      addPatientFormDiv.style.display = 'block';
      document.getElementById('diagnosisSection').style.display = 'none';
      fetchNextPatientId();
      successMsg.textContent = '';
    });

    patientForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const formData = new FormData(patientForm);
      fetch('/submit_patient', { method:'POST', body: formData })
      .then(res => res.json())
      .then(data => {
        if(data.status === 'success'){
          successMsg.textContent = 'Patient added successfully!';
          patientForm.reset();
          fetchNextPatientId();
        }
      });
    });

    // Diagnosis Section
    const diagnosisBtn = document.getElementById('diagnosisBtn');
    const diagnosisSection = document.getElementById('diagnosisSection');
    const diagnosisTableBody = document.getElementById('diagnosisTableBody');

    diagnosisBtn.addEventListener('click', () => {
      addPatientFormDiv.style.display = 'none';
      diagnosisSection.style.display = 'block';
      fetch('/get_diagnosis')
        .then(res => res.json())
        .then(data => {
          diagnosisTableBody.innerHTML = '';
          data.forEach(patient => {
            diagnosisTableBody.innerHTML += `
              <tr>
                <td>${patient.id}</td>
                <td>${patient.name}</td>
                <td>${patient.age}</td>
                <td>${patient.gender}</td>
                <td>${patient.contact}</td>
                <td>${patient.address}</td>
                <td>${patient.disease}</td>
                <td><span class="deleteBtn" onclick="deletePatient(${patient.id})"><i class="fas fa-trash"></i></span></td>
              </tr>
            `;
          });
        });
    });

    function deletePatient(id){
      fetch('/delete_patient/'+id,{method:'DELETE'})
      .then(res=>res.json())
      .then(data=>{
        if(data.status==='success'){
          document.querySelector(`#diagnosisTableBody tr td:first-child:contains(${id})`)?.parentElement.remove();
        }
      });
    }

    // Disease Bar Chart - sharper, modern
    new Chart(document.getElementById('diseaseChart'), {
      type: 'bar',
      data: {
        labels: ['Flu', 'Cold', 'Fever', 'Diabetes', 'Asthma'],
        datasets: [{
          label: 'Patients',
          data: [25, 18, 15, 10, 8],
          backgroundColor: ['#c62828','#f06292','#c62828','#f06292','#c62828'],
          borderRadius: 6,
          barPercentage: 0.6
        }]
      },
      options: { responsive:true, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}} }
    });

    // Patient Demographics Pie Chart
    new Chart(document.getElementById('demographicsChart'), {
      type: 'pie',
      data: {
        labels: ['Male','Female','Other'],
        datasets: [{
          data: [60,35,5],
          backgroundColor: ['#c62828','#f06292','#ef9a9a']
        }]
      },
      options:{ responsive:true }
    });

    // Staff Attendance Line Chart
    new Chart(document.getElementById('staffChart'), {
      type: 'line',
      data: {
        labels: ['Mon','Tue','Wed','Thu','Fri'],
        datasets:[{
          label:'Attendance',
          data:[8,7,9,6,8],
          borderColor:'#c62828',
          backgroundColor:'rgba(198,40,40,0.2)',
          fill:true,
          tension:0.3,
          pointRadius:5,
          pointHoverRadius:7
        }]
      },
      options:{ responsive:true, plugins:{legend:{display:false}} }
    });

    // Simple JS calendar
    const calendar = document.getElementById('calendar');
    const date = new Date();
    calendar.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
      <span>${date.toLocaleString('default', { month: 'long' })} ${date.getFullYear()}</span>
    </div>`;
    let days = '';
    for(let i=1;i<=30;i++){
      days += `<span style="display:inline-block;width:12%;margin:1%;padding:5px;background:#fdeaea;border-radius:4px;text-align:center;">${i}</span>`;
    }
    calendar.innerHTML += `<div style="display:flex; flex-wrap:wrap;">${days}</div>`;
  </script>
</body>
</html>
